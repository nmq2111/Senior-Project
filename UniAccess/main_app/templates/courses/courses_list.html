{% extends 'base.html' %}

{% block styles %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="container py-4">

  <div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="text-danger mb-0">Courses</h2>
      {% if user.role == "admin" or user.is_superuser %}
      <a class="btn btn-danger" href="{% url 'course_create' %}">+ Add Course</a>
      {% endif %}
    </div>
  </div>

      <form method="get" class="filters row g-3 align-items-end mb-4">
        <div class="col-md-auto">
          <label class="form-label">Search</label>
          <input type="text" class="form-control" name="q" value="{{ q }}" placeholder="code or name">
        </div>

        <div class="col-md-auto">
          <label class="form-label">College</label>
          <select class="form-select" name="college">
            <option value="">All colleges</option>
            {% for val, label in college_opts %}
              <option value="{{ val }}" {% if college == val %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-auto">
          <label class="form-label">Sort</label>
          <select class="form-select" name="order">
            <option value="code"  {% if order == 'code' %}selected{% endif %}>Code ↑</option>
            <option value="-code" {% if order == '-code' %}selected{% endif %}>Code ↓</option>
            <option value="name"  {% if order == 'name' %}selected{% endif %}>Name ↑</option>
            <option value="-name" {% if order == '-name' %}selected{% endif %}>Name ↓</option>
          </select>
        </div>

        <div class="col-md-auto mt-4 d-flex gap-2">
          <button class="btn btn-outline-danger" type="submit">Apply</button>
          <a class="btn btn-outline-secondary" href="{% url 'courses_list' %}">Clear</a>
        </div>
      </form>
  

      <div class="card shadow-sm">
        <div class="card-header bg-danger text-white d-flex justify-content-between">
          <strong>All Courses</strong>
          <span class="text-light">Total: {{ courses|length }}</span>
        </div>
        <div class="table-responsive">
          <table class="table table-striped table-hover mb-0 w-100">
            <thead class="table-light">
              <tr>
                <th>Code</th>
                <th>Name</th>
                <th>College</th>
                {% if user.role == "admin" or user.is_superuser %}
                  <th>Actions</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for c in courses %}
              <tr>
                <td><code>{{ c.code }}</code></td>
                <td>{{ c.name }}</td>
                <td>
                  {% for val, label in college_opts %}
                    {% if c.college == val %}{{ label }}{% endif %}
                  {% endfor %}
                </td>
                {% if user.role == "admin" or user.is_superuser %}
                <td class="d-flex gap-2">
                  <a href="{% url 'course_edit' c.id %}" class="btn btn-outline-danger btn-sm">Edit</a>
                  <a href="{% url 'course_delete' c.id %}" class="btn btn-outline-danger btn-sm">Delete</a>
                </td>
                {% endif %}
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted">No courses found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
  </div>

</div>
{% endblock %}
