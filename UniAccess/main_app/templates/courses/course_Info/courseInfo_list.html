{% extends 'base.html' %}

{% block styles %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .nowrap {
      white-space: nowrap;
    }
    .table td, .table th {
      vertical-align: middle;
      text-align: center;
    }
    .card {
      width: 100%;
    }
  </style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-danger mb-0">Available Sections</h2>
    {% if user.is_staff or user.is_superuser %}
      <a class="btn btn-danger" href="{% url 'courseInfo_create' %}">+ Add Course</a>
    {% endif %}
  </div>

  <!-- Filter Form -->
  <form method="get" class="filters row g-3 align-items-end mb-4">
    <div class="col-md-auto">
      <label class="form-label">Search</label>
      <input type="text" class="form-control" name="q" value="{{ q }}" placeholder="code / course name / class">
    </div>
    <div class="col-md-auto">
      <label class="form-label">College</label>
      <select class="form-select" name="college">
        <option value="">All</option>
        {% for val,label in college_opts %}
          <option value="{{ val }}" {% if college == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-auto">
      <label class="form-label">Year</label>
      <select class="form-select" name="year">
        <option value="">All</option>
        {% for y in year_opts %}
          <option value="{{ y }}" {% if year|stringformat:"s" == y|stringformat:"s" %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-auto">
      <label class="form-label">Semester</label>
      <select class="form-select" name="semester">
        <option value="">All</option>
        {% for val,label in semester_opts %}
          <option value="{{ val }}" {% if semester == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-auto">
      <label class="form-label">Status</label>
      <select class="form-select" name="status">
        <option value="">All</option>
        {% for val,label in status_opts %}
          <option value="{{ val }}" {% if status == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="col-md-auto mt-4 d-flex gap-2">
      <button class="btn btn-outline-danger" type="submit">Apply</button>
      <a class="btn btn-outline-secondary" href="{% url 'courseInfo_list' %}">Clear</a>
    </div>
  </form>

  
  <div class="card shadow-sm">
    <div class="card-header bg-danger text-white d-flex justify-content-between">
      <strong>Sections</strong>
      <span class="text-light">Total: {{ sections|length }}</span>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0 w-100">
        <thead class="table-light">
          <tr>
            <th class="nowrap">Code</th>
            <th>Course</th>
            <th class="nowrap">Year / Sem</th>
            <th class="nowrap">Status</th>
            <th class="nowrap">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for ci in sections %}
          <tr>
            <td><code>{{ ci.course.code }}</code></td>
            <td>{{ ci.course.name }}</td>
            <td>{{ ci.year }} / {{ ci.get_semester_display }}</td>
            <td>
              {% if ci.status == "Yes" %}
                <span class="badge bg-danger">Available</span>
              {% else %}
                <span class="badge bg-secondary">Not Available</span>
              {% endif %}
            </td>
            <td class="d-flex gap-2 justify-content-center">
              <a href="{% url 'courseInfo_detail' ci.id %}" class="btn btn-sm btn-outline-danger">View</a>
              {% if user.is_staff or user.is_superuser %}
                <a href="{% url 'courseInfo_edit' ci.pk %}" class="btn btn-sm btn-outline-danger">Edit</a>
                <a href="{% url 'courseInfo_delete' ci.pk %}" class="btn btn-sm btn-outline-danger">Delete</a>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center text-muted">No sections found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if user.is_authenticated and user.role == "student" %}
  <div class="mt-4">
    <a href="{% url 'register_course' %}" class="btn btn-danger">Register for a Course</a>
  </div>
  {% endif %}

</div>
{% endblock %}
