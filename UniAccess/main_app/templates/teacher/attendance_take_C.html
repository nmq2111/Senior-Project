{% extends "base.html" %} {% load tz %} {% block styles %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
{% endblock %} {% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-danger mb-0">My Attendance</h2>
    <div>
      <a
        href="{% url 'teacher_attendance_list' %}"
        class="btn btn-outline-secondary btn-sm"
        >Refresh</a
      >
      <a
        href="{% url 'attendance_take_C' %}"
        class="btn btn-outline-danger btn-sm"
        >Take</a
      >
    </div>
  </div>

  {% if messages %} {% for m in messages %}
  <div class="alert alert-{{ m.tags|default:'info' }} mb-2">{{ m }}</div>
  {% endfor %} {% endif %}

  <div class="card shadow-sm mb-4">
    <div
      class="card-header bg-danger text-white d-flex flex-wrap justify-content-between align-items-center"
    >
      <strong>Take Attendance</strong>
      <form method="get" class="d-flex align-items-end gap-2">
        {# keep current filters when changing date #}
        <input type="hidden" name="q" value="{{ q }}" />
        <input type="hidden" name="status" value="{{ status }}" />
        <input type="hidden" name="course_info" value="{{ section_id }}" />
        <input type="hidden" name="start" value="{{ start }}" />
        <input type="hidden" name="end" value="{{ end }}" />
        <input type="hidden" name="order" value="{{ order }}" />
        <div>
          <label class="form-label text-white-50 mb-0">Date</label>
          <input
            type="date"
            name="date"
            value="{{ session_date|date:'Y-m-d' }}"
            class="form-control form-control-sm"
          />
        </div>
        <button class="btn btn-light btn-sm">Set</button>
      </form>
    </div>

    <div class="card-body">
      {% regroup teacher_sections by course as by_course %} {% if by_course %}
      {% for group in by_course %}
      <div class="mb-3 p-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0">
            <code>{{ group.grouper.code }}</code> — {{ group.grouper.name }}
          </h6>
        </div>

        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead>
              <tr>
                <th class="text-muted small">Section</th>
                <th class="text-muted small">Class</th>
                <th class="text-muted small nowrap">Days</th>
                <th class="text-muted small nowrap">Time</th>
                <th class="text-muted small">Status</th>
                <th class="text-muted small text-center nowrap">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for ci in group.list %}
              <tr>
                <td class="nowrap">#{{ ci.section|default:"—" }}</td>
                <td>{{ ci.class_name }}</td>
                <td class="nowrap">{{ ci.get_days_display }}</td>
                <td class="nowrap">
                  {{ ci.start_time|time:"H:i" }}–{{ ci.end_time|time:"H:i" }}
                </td>
                <td>
                  {% if ci.status in "Yes,Available" %}
                  <span class="badge text-bg-success">Open</span>
                  {% else %}
                  <span class="badge text-bg-secondary">Closed</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  <a
                    class="btn btn-danger btn-sm"
                    href="{% url 'teacher_take_attendance' ci.id %}?date={{ session_date|date:'Y-m-d' }}"
                    title="Take attendance for this section"
                  >
                    Take Attendance
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endfor %} {% else %}
      <div class="text-muted">No sections assigned to you.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
